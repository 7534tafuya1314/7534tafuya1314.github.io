<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>哲理论-探索思维的点滴</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Noto+Sans+SC:wght@700;900&family=Krona+One&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#8B5A2B',
                        secondary: '#D2B48C',
                        accent: '#CD853F',
                        dark: '#3E2723',
                        light: '#F5F5DC'
                    }
                }
            }
        }
    </script>
    
    <style type="text/tailwindcss">
        @layer utilities {
            .text-shadow {
                text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
            }
            .transition-all-300 {
                transition: all 0.3s ease;
            }
            .editor-toolbar {
                @apply bg-gray-100 p-2 border-b flex flex-wrap gap-2;
            }
            .editor-button {
                @apply p-1.5 rounded hover:bg-gray-200 transition-all-300;
            }
        }
        
        body {
            background-color: #F5F5DC;
            font-family: 'Noto Sans SC', sans-serif;
        }
        
        .哲学标题 {
            font-family: 'Krona One', sans-serif;
        }
        
        .hero-section {
            background-image: url('https://p11-flow-imagex-download-sign.byteimg.com/tos-cn-i-a9rns2rl98/9005186ae3764f5885bf9fb051e353ed.png~tplv-a9rns2rl98-24:720:720.png?rcl=20251004093514250C7EA54B20B9A718B5&rk3s=8e244e95&rrcfp=8a172a1a&x-expires=1760146514&x-signature=%2BhaweaigBWWu8yZUpDV74jGJQtQ%3D');
            background-size: cover;
            background-position: center;
            position: relative;
            height: 96px;
        }
        
        @media (min-width: 768px) {
            .hero-section {
                height: 384px;
            }
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .分类标签 {
            display: inline-flex;
            align-items: center;
            padding: 4px 8px;
            background-color: #D2B48C;
            color: #3E2723;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            margin: 0 8px 8px 0;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .分类标签:hover, .分类标签.active {
            background-color: #8B5A2B;
            color: white;
        }
        
        .文章-card {
            border-radius: 8px;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .文章-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .modal-content {
            background-color: #fff;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 100%;
            max-width: 1000px;
            position: relative;
            animation: modalFadeIn 0.3s ease;
        }
        
        @keyframes modalFadeIn {
            from {opacity: 0; transform: translateY(-50px);}
            to {opacity: 1; transform: translateY(0);}
        }
        
        .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 24px;
            cursor: pointer;
            transition: color 0.2s;
        }
        
        .close-btn:hover {
            color: #8B5A2B;
        }
        
        /* 小巧的加载指示器样式 */
        .small-loader {
            border: 3px solid rgba(139, 90, 43, 0.2);
            border-radius: 50%;
            border-top: 3px solid #8B5A2B;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
            margin: 10px auto;
        }
        
        .loader-container {
            text-align: center;
            padding: 20px 0;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .今日日期标记 {
            border: 2px solid #8B5A2B;
            background-color: rgba(139, 90, 43, 0.1);
        }
        
        .哲言区域 {
            border-top: 1px solid #eee;
            padding-top: 15px;
            margin-top: 15px;
            font-style: italic;
            color: #555;
        }
        
        .admin-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 20px;
        }
        
        @media (max-width: 767px) {
            .admin-container {
                grid-template-columns: 1fr;
            }
        }
        
        .admin-sidebar {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
            height: fit-content;
        }
        
        .admin-content {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 20px;
        }
        
        .admin-menu-item {
            padding: 10px 15px;
            border-radius: 4px;
            margin-bottom: 5px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .admin-menu-item:hover, .admin-menu-item.active {
            background-color: #e9ecef;
        }
        
        .admin-section {
            display: none;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .markdown-editor {
            border: 1px solid #ddd;
            border-radius: 4px;
            overflow: hidden;
        }
        
        #article-editor {
            width: 100%;
            min-height: 300px;
            border: none;
            padding: 15px;
            resize: vertical;
            font-family: monospace;
        }
        
        #preview-container {
            border-top: 1px solid #ddd;
            padding: 15px;
            background-color: #f9f9f9;
        }
        
        .status-message {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            z-index: 1001;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .status-message.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .status-success {
            background-color: #4CAF50;
        }
        
        .status-error {
            background-color: #f44336;
        }
        
        .error-log {
            margin-top: 10px;
            padding: 10px;
            background-color: #fff3f3;
            border-radius: 4px;
            font-size: 0.875rem;
            color: #dc2626;
        }
        
        .repo-item {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .repo-item:hover {
            background-color: #f5f5f5;
            border-color: #8B5A2B;
        }
        
        .repo-item.selected {
            background-color: #f0e6d6;
            border-color: #8B5A2B;
        }

        /* 修复分类选择器样式 */
        .category-checkbox {
            display: none;
        }
        
        .category-checkbox + label {
            padding: 4px 10px;
            border-radius: 4px;
            border: 1px solid #8B5A2B;
            color: #3E2723;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .category-checkbox:checked + label {
            background-color: #8B5A2B;
            color: white;
        }
    </style>
</head>
<body>
    <!-- 导航栏 -->
    <nav class="bg-dark text-white p-4 sticky top-0 z-50">
        <div class="container mx-auto flex justify-between items-center">
            <h1 class="text-2xl md:text-3xl font-bold 哲学标题">哲理论</h1>
            <div class="flex items-center gap-4">
                <button id="尘幕工作室按钮" class="hover:text-secondary transition-all-300 flex items-center gap-1">
                    <i class="fa fa-cogs" aria-hidden="true"></i>
                    <span class="hidden sm:inline">尘幕工作室</span>
                </button>
                <button id="日历按钮" class="hover:text-secondary transition-all-300">
                    <i class="fa fa-calendar" aria-hidden="true"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- 英雄区域 -->
    <section class="hero-section flex items-center justify-center">
        <div class="container mx-auto px-4 text-center text-white relative z-10">
            <h1 class="text-4xl md:text-6xl font-bold mb-4 text-shadow">探索思维的点滴</h1>
            <p class="text-xl md:text-2xl max-w-2xl mx-auto">记录哲学思考，分享思想火花</p>
        </div>
    </section>

    <!-- 分类区域 -->
    <section class="py-8 bg-light">
        <div class="container mx-auto px-4">
            <div id="分类容器" class="flex flex-wrap mb-8">
                <span class="分类标签 active" data-category="all">全部</span>
                <!-- 分类标签通过JS动态生成 -->
            </div>
        </div>
    </section>

    <!-- 文章列表区域 -->
    <section class="py-8">
        <div class="container mx-auto px-4">
            <!-- 加载指示器容器 -->
            <div id="文章加载指示器" class="loader-container">
                <div class="small-loader"></div>
                <p class="text-gray-500 text-sm mt-2">加载文章中...</p>
            </div>
            
            <div id="文章列表" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 hidden">
                <!-- 文章卡片通过JS动态生成 -->
            </div>
        </div>
    </section>

    <!-- 日历模态框 -->
    <div id="日历模态框" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div class="p-6">
                <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-6">
                    <div class="mb-3 md:mb-0">
                        <h2 class="text-2xl font-bold">日历</h2>
                        <div id="当前时间显示" class="text-gray-600 mt-1"></div>
                    </div>
                    <div class="flex space-x-2">
                        <button id="上一月" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-l">
                            <i class="fa fa-chevron-left" aria-hidden="true"></i>
                        </button>
                        <span id="当前年月" class="px-4 py-1 bg-gray-100"></span>
                        <button id="下一月" class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded-r">
                            <i class="fa fa-chevron-right" aria-hidden="true"></i>
                        </button>
                    </div>
                </div>
                <div id="日历网格" class="grid grid-cols-7 gap-2 text-center mb-6">
                    <!-- 日历通过JS动态生成 -->
                </div>
                <div id="哲言区域" class="哲言区域 text-center">
                    <!-- 哲言通过JS动态生成 -->
                </div>
            </div>
        </div>
    </div>

    <!-- 文章详情模态框 -->
    <div id="文章详情模态框" class="modal">
        <div class="modal-content">
            <span class="close-btn">&times;</span>
            <div id="文章详情内容">
                <!-- 文章详情通过JS动态生成 -->
            </div>
        </div>
    </div>

    <!-- 仓库检测失败提示模态框 -->
    <div id="repo-detect-fail-modal" class="modal">
        <div class="modal-content max-w-md">
            <span class="close-btn">&times;</span>
            <div class="p-6">
                <h2 class="text-2xl font-bold mb-4 text-red-500">仓库检测失败</h2>
                <p class="mb-4">无法从URL自动检测GitHub仓库信息。请输入GitHub令牌，我们将从您的仓库中查找。</p>
                <div id="repo-detect-error" class="error-log mb-4"></div>
                <button id="go-to-auth-btn" class="w-full bg-primary text-white py-2 px-4 rounded hover:bg-accent transition-all-300">
                    输入GitHub令牌
                </button>
            </div>
        </div>
    </div>

    <!-- 仓库选择模态框 -->
    <div id="repo-select-modal" class="modal">
        <div class="modal-content max-w-2xl">
            <span class="close-btn">&times;</span>
            <div class="p-6">
                <h2 class="text-2xl font-bold mb-4">选择博客仓库</h2>
                <p class="mb-4 text-gray-600">请选择用于存储博客文章的仓库（推荐使用名称包含"philosophy"或"blog"的仓库）</p>
                
                <div id="repo-loading" class="text-center py-8">
                    <div class="small-loader"></div>
                    <p class="text-gray-500 mt-4">加载您的仓库列表中...</p>
                </div>
                
                <div id="repo-list-container" class="hidden max-h-96 overflow-y-auto pr-2">
                    <div id="repo-list" class="space-y-2">
                        <!-- 仓库列表将通过JS动态生成 -->
                    </div>
                </div>
                
                <div id="repo-select-error" class="error-log mb-4 hidden"></div>
                
                <div class="mt-6 flex justify-end">
                    <button id="confirm-repo-btn" class="bg-primary text-white py-2 px-6 rounded hover:bg-accent transition-all-300 disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                        确认选择
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- GitHub令牌验证模态框 -->
    <div id="github验证模态框" class="modal">
        <div class="modal-content max-w-md">
            <span class="close-btn">&times;</span>
            <div class="p-6">
                <h2 class="text-2xl font-bold mb-4">GitHub API 验证</h2>
                <p class="mb-4 text-gray-600">请输入您的GitHub个人访问令牌以访问管理功能</p>
                <div class="mb-4">
                    <label for="github-token" class="block mb-2">个人访问令牌</label>
                    <input type="password" id="github-token" class="w-full p-2 border border-gray-300 rounded" placeholder="ghp_...">
                    <p class="text-xs text-gray-500 mt-1">令牌需要有 repo 权限（创建时勾选repo选项）</p>
                </div>
                <button id="验证按钮" class="w-full bg-primary text-white py-2 px-4 rounded hover:bg-accent transition-all-300">
                    验证并继续
                </button>
                <div id="验证状态" class="mt-3 text-center hidden"></div>
                <div id="验证错误日志" class="error-log"></div>
            </div>
        </div>
    </div>
        <!-- 后台管理模态框 -->
    <div id="后台管理模态框" class="modal">
        <div class="modal-content max-w-5xl">
            <span class="close-btn">&times;</span>
            <div class="p-6">
                <h2 class="text-2xl font-bold mb-6">后台管理</h2>
                <div id="admin-loading" class="text-center py-8">
                    <div class="small-loader"></div>
                    <p class="text-gray-500 mt-4">加载管理界面中...</p>
                </div>
                <div class="admin-container hidden" id="admin-content-container">
                    <div class="admin-sidebar">
                        <div class="admin-menu-item active" data-section="write-article">
                            <i class="fa fa-pencil mr-2"></i>撰写文章
                        </div>
                        <div class="admin-menu-item" data-section="manage-articles">
                            <i class="fa fa-list mr-2"></i>管理文章
                        </div>
                        <div class="admin-menu-item" data-section="manage-categories">
                            <i class="fa fa-tags mr-2"></i>管理分类
                        </div>
                        <div class="admin-menu-item" id="切换仓库按钮">
                            <i class="fa fa-exchange mr-2"></i>切换仓库
                        </div>
                        <div class="admin-menu-item" id="退出登录按钮">
                            <i class="fa fa-sign-out mr-2"></i>退出登录
                        </div>
                        <div class="mt-6 pt-6 border-t">
                            <p class="text-sm text-gray-500">当前仓库: <br><span id="current-repo-info" class="font-medium"></span></p>
                        </div>
                    </div>
                    
                    <div class="admin-content">
                        <!-- 撰写文章区域 -->
                        <div class="admin-section active" id="write-article">
                            <h3 class="text-xl font-bold mb-4">撰写新文章</h3>
                            
                            <div class="mb-4">
                                <label for="article-title" class="block mb-2">文章标题</label>
                                <input type="text" id="article-title" class="w-full p-2 border border-gray-300 rounded" placeholder="输入文章标题">
                            </div>
                            
                            <div class="mb-4">
                                <label class="block mb-2">选择分类 (可多选)</label>
                                <div id="category-selector" class="flex flex-wrap gap-2">
                                    <!-- 分类选项将通过JS动态生成 -->
                                </div>
                            </div>
                            
                            <div class="mb-4">
                                <label class="block mb-2">文章内容 (Markdown格式)</label>
                                <div class="markdown-editor">
                                    <div class="editor-toolbar">
                                        <button class="editor-button" data-command="bold" title="加粗"><i class="fa fa-bold"></i></button>
                                        <button class="editor-button" data-command="italic" title="斜体"><i class="fa fa-italic"></i></button>
                                        <button class="editor-button" data-command="heading" title="标题"><i class="fa fa-header"></i></button>
                                        <button class="editor-button" data-command="list" title="列表"><i class="fa fa-list-ul"></i></button>
                                        <button class="editor-button" data-command="link" title="链接"><i class="fa fa-link"></i></button>
                                        <button class="editor-button" data-command="image" title="图片"><i class="fa fa-image"></i></button>
                                        <button class="editor-button" data-command="code" title="代码"><i class="fa fa-code"></i></button>
                                    </div>
                                    <textarea id="article-editor" placeholder="请使用Markdown格式编写文章内容...&#10;&#10;注意: 文章第一行用于指定分类ID，用逗号分隔，空行表示无分类"></textarea>
                                    <div id="preview-container">
                                        <p class="text-gray-500 italic">预览将显示在这里...</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex justify-end">
                                <button id="发布文章按钮" class="bg-primary text-white py-2 px-6 rounded hover:bg-accent transition-all-300">
                                    <i class="fa fa-paper-plane mr-2"></i>发布文章
                                </button>
                            </div>
                        </div>
                        
                        <!-- 管理文章区域 -->
                        <div class="admin-section" id="manage-articles">
                            <h3 class="text-xl font-bold mb-4">管理已发布文章</h3>
                            <div class="overflow-x-auto">
                                <table id="articles-table" class="min-w-full bg-white">
                                    <thead>
                                        <tr class="bg-gray-100">
                                            <th class="py-3 px-4 text-left">标题</th>
                                            <th class="py-3 px-4 text-left">发布日期</th>
                                            <th class="py-3 px-4 text-left">分类</th>
                                            <th class="py-3 px-4 text-center">操作</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- 文章数据将通过JS动态生成 -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        
                        <!-- 管理分类区域 -->
                        <div class="admin-section" id="manage-categories">
                            <h3 class="text-xl font-bold mb-4">管理分类</h3>
                            
                            <div class="mb-6">
                                <h4 class="font-bold mb-2">添加新分类</h4>
                                <div class="flex gap-2">
                                    <input type="text" id="new-category-name" class="flex-1 p-2 border border-gray-300 rounded" placeholder="分类名称">
                                    <button id="add-category-btn" class="bg-primary text-white py-2 px-4 rounded hover:bg-accent transition-all-300">
                                        添加
                                    </button>
                                </div>
                            </div>
                            
                            <div>
                                <h4 class="font-bold mb-2">现有分类</h4>
                                <div id="categories-list" class="space-y-2">
                                    <!-- 分类列表将通过JS动态生成 -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 状态消息提示 -->
    <div id="status-message" class="status-message"></div>

    <script>
        // 配置模块 - 已设置为指定仓库
        const Config = {
            githubAPI: 'https://api.github.com',
            defaultRepoName: '7534tafuya1314.github.io', // 指定仓库名
            articlesDir: 'articles',
            categoriesFile: 'categories.json',
            syncInterval: 30000 // 自动同步间隔30秒
        };

        // 状态管理模块
        const State = {
            articles: [],
            categories: [], // 分类格式: { id: 1, name: "分类名称" }
            currentDate: new Date(),
            selectedCategory: 'all',
            githubToken: localStorage.getItem('githubToken') || null,
            githubOwner: '7534tafuya1314', // 固定仓库所有者
            githubRepo: '7534tafuya1314.github.io', // 固定仓库名
            isAuthenticated: !!localStorage.getItem('githubToken'),
            lastSyncTime: null,
            philosophicalQuotes: [
                { quote: "未经审视的人生，是不值得过的。", author: "苏格拉底" },
                { quote: "存在先于本质。", author: "萨特" },
                { quote: "我思故我在。", author: "笛卡尔" },
                { quote: "世界是一团永恒的活火。", author: "赫拉克利特" },
                { quote: "人不能两次踏入同一条河流。", author: "赫拉克利特" },
                { quote: "知之为知之，不知为不知，是知也。", author: "孔子" },
                { quote: "真理是时间的孩子，不是权威的孩子。", author: "伽利略" },
                { quote: "人是万物的尺度。", author: "普罗泰戈拉" },
                { quote: "过去属于死神，未来属于你自己。", author: "雪莱" },
                { quote: "人是生而自由的，但却无往不在枷锁之中。", author: "卢梭" }
            ],
            articleSummaryCache: new Map(),
            selectedRepo: null // 当前选中的仓库
        };

        // DOM元素缓存模块
        const Elements = (() => {
            const get = (id) => document.getElementById(id);
            return {
                // 导航与主要功能
                日历按钮: get('日历按钮'),
                日历模态框: get('日历模态框'),
                文章详情模态框: get('文章详情模态框'),
                分类容器: get('分类容器'),
                文章列表: get('文章列表'),
                文章加载指示器: get('文章加载指示器'),
                上一月按钮: get('上一月'),
                下一月按钮: get('下一月'),
                当前年月显示: get('当前年月'),
                日历网格: get('日历网格'),
                当前时间显示: get('当前时间显示'),
                哲言区域: get('哲言区域'),
                文章详情内容: get('文章详情内容'),
                尘幕工作室按钮: get('尘幕工作室按钮'),
                
                // 仓库检测与选择
                repoDetectFailModal: get('repo-detect-fail-modal'),
                repoDetectError: get('repo-detect-error'),
                goToAuthBtn: get('go-to-auth-btn'),
                repoSelectModal: get('repo-select-modal'),
                repoList: get('repo-list'),
                repoListContainer: get('repo-list-container'),
                repoLoading: get('repo-loading'),
                repoSelectError: get('repo-select-error'),
                confirmRepoBtn: get('confirm-repo-btn'),
                切换仓库按钮: get('切换仓库按钮'),
                
                // GitHub验证
                github验证模态框: get('github验证模态框'),
                githubTokenInput: get('github-token'),
                验证按钮: get('验证按钮'),
                验证状态: get('验证状态'),
                验证错误日志: get('验证错误日志'),
                
                // 后台管理
                后台管理模态框: get('后台管理模态框'),
                退出登录按钮: get('退出登录按钮'),
                adminMenuItems: document.querySelectorAll('.admin-menu-item'),
                adminSections: document.querySelectorAll('.admin-section'),
                发布文章按钮: get('发布文章按钮'),
                articleTitleInput: get('article-title'),
                articleEditor: get('article-editor'),
                previewContainer: get('preview-container'),
                categorySelector: get('category-selector'),
                articlesTable: get('articles-table'),
                newCategoryName: get('new-category-name'),
                addCategoryBtn: get('add-category-btn'),
                categoriesList: get('categories-list'),
                adminLoading: get('admin-loading'),
                adminContentContainer: get('admin-content-container'),
                currentRepoInfo: get('current-repo-info'),
                
                // 通用
                statusMessage: get('status-message'),
                closeButtons: document.querySelectorAll('.close-btn'),
                modals: document.querySelectorAll('.modal'),
                editorButtons: document.querySelectorAll('.editor-button')
            };
        })();

        // 工具函数模块
        const Utils = {
            formatDate(date) {
                return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
            },
            
            formatDateTime(date) {
                return `${this.formatDate(date)} ${String(date.getHours()).padStart(2, '0')}:${String(date.getMinutes()).padStart(2, '0')}`;
            },
            
            htmlToText(html) {
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = html;
                return tempDiv.textContent || '';
            },
            
            getArticleSummary(content) {
                if (State.articleSummaryCache.has(content)) {
                    return State.articleSummaryCache.get(content);
                }
                
                const plainText = this.htmlToText(content);
                const summary = plainText.length > 100 
                    ? plainText.substring(0, 100) + '...' 
                    : plainText;
                
                State.articleSummaryCache.set(content, summary);
                return summary;
            },
            
            createFragment() {
                return document.createDocumentFragment();
            },
            
            showStatusMessage(message, isError = false) {
                const statusEl = Elements.statusMessage;
                statusEl.textContent = message;
                statusEl.className = 'status-message';
                statusEl.classList.add(isError ? 'status-error' : 'status-success');
                statusEl.classList.add('show');
                
                setTimeout(() => {
                    statusEl.classList.remove('show');
                }, 3000);
            },
            
            encodeBase64(str) {
                return btoa(unescape(encodeURIComponent(str)));
            },
            
            decodeBase64(str) {
                return decodeURIComponent(escape(atob(str)));
            },
            
            generateArticleFileName(title) {
                const date = this.formatDate(new Date());
                const sanitizedTitle = title.toLowerCase()
                    .replace(/[^a-z0-9\s]/g, '')
                    .replace(/\s+/g, '-');
                return `${date}-${sanitizedTitle}.md`;
            },
            
            showErrorLog(element, message) {
                element.textContent = message;
                element.style.display = 'block';
            },
            
            hideErrorLog(element) {
                element.textContent = '';
                element.style.display = 'none';
            },
            
            // 添加时间戳参数防止缓存
            addCacheBuster(url) {
                const separator = url.includes('?') ? '&' : '?';
                return `${url}${separator}t=${new Date().getTime()}`;
            },
            
            // 保存仓库信息到本地存储
            saveRepoInfo(owner, repo) {
                localStorage.setItem('githubOwner', owner);
                localStorage.setItem('githubRepo', repo);
                State.githubOwner = owner;
                State.githubRepo = repo;
            },
            
            // 获取下一个可用的分类ID（确保为数字1,2,3...）
            getNextCategoryId() {
                if (State.categories.length === 0) {
                    return 1;
                }
                // 找出最大的ID并加1
                const maxId = Math.max(...State.categories.map(cat => cat.id));
                return maxId + 1;
            },
            
            // 根据ID查找分类名称
            getCategoryNameById(id) {
                const category = State.categories.find(cat => cat.id === id);
                return category ? category.name : '';
            },
            
            // 根据ID数组获取分类名称列表
            getCategoryNamesByIds(ids) {
                if (!ids || !Array.isArray(ids)) return [];
                return ids.map(id => this.getCategoryNameById(id)).filter(Boolean);
            }
        };

        // GitHub API模块 - 修改为支持匿名访问公开仓库
        const GitHubAPI = {
            getHeaders(needAuth = false) {
                const headers = {
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json'
                };
                
                // 只有需要认证的操作才添加令牌
                if (needAuth && State.githubToken) {
                    headers['Authorization'] = `token ${State.githubToken}`;
                }
                
                return headers;
            },
            
            // 获取用户信息（用于验证令牌）
            async getUserInfo() {
                try {
                    const response = await fetch(`${Config.githubAPI}/user`, {
                        headers: this.getHeaders(true)
                    });
                    
                    if (!response.ok) {
                        const error = await response.text();
                        console.error('获取用户信息失败:', error);
                        return null;
                    }
                    
                    return await response.json();
                } catch (error) {
                    console.error('获取用户信息时发生错误:', error);
                    return null;
                }
            },
            
            // 获取用户的仓库列表
            async getUserRepos() {
                try {
                    const response = await fetch(`${Config.githubAPI}/user/repos?per_page=100`, {
                        headers: this.getHeaders(true)
                    });
                    
                    if (!response.ok) {
                        const error = await response.text();
                        console.error('获取仓库列表失败:', error);
                        return { success: false, error };
                    }
                    
                    const repos = await response.json();
                    return { success: true, repos };
                } catch (error) {
                    console.error('获取仓库列表时发生错误:', error);
                    return { success: false, error: error.message };
                }
            },
            
            async testToken() {
                const userInfo = await this.getUserInfo();
                return !!userInfo;
            },
            
            // 获取指定路径下的文件列表 - 公开仓库不需要认证
            async getFilesList(path, needAuth = false) {
                try {
                    const response = await fetch(
                        `${Config.githubAPI}/repos/${State.githubOwner}/${State.githubRepo}/contents/${path}`,
                        { headers: this.getHeaders(needAuth) }
                    );
                    
                    if (!response.ok) {
                        // 如果是404错误，可能是目录不存在，可以视为空列表
                        if (response.status === 404) {
                            return { success: true, files: [] };
                        }
                        
                        const error = await response.text();
                        console.error('获取文件列表失败:', error);
                        return { success: false, error };
                    }
                    
                    const files = await response.json();
                    return { success: true, files };
                } catch (error) {
                    console.error('获取文件列表时发生错误:', error);
                    return { success: false, error: error.message };
                }
            },
            
            // 获取文件内容 - 公开仓库不需要认证
            async getFileContent(path, needAuth = false) {
                try {
                    const response = await fetch(
                        `${Config.githubAPI}/repos/${State.githubOwner}/${State.githubRepo}/contents/${path}`,
                        { headers: this.getHeaders(needAuth) }
                    );
                    
                    if (!response.ok) {
                        const error = await response.text();
                        console.error(`获取文件 ${path} 内容失败:`, error);
                        return { success: false, error };
                    }
                    
                    const fileData = await response.json();
                    // 解码base64内容
                    const content = fileData.content ? Utils.decodeBase64(fileData.content) : '';
                    return { 
                        success: true, 
                        content,
                        sha: fileData.sha // 保存SHA值用于后续更新
                    };
                } catch (error) {
                    console.error(`获取文件 ${path} 内容时发生错误:`, error);
                    return { success: false, error: error.message };
                }
            },
            
            // 创建或更新文件 - 需要认证
            async createOrUpdateFile(path, content, message, sha = null) {
                try {
                    const body = {
                        message: message || `Update ${path}`,
                        content: Utils.encodeBase64(content)
                    };
                    
                    // 如果提供了sha，则是更新操作
                    if (sha) {
                        body.sha = sha;
                    }
                    
                    const response = await fetch(
                        `${Config.githubAPI}/repos/${State.githubOwner}/${State.githubRepo}/contents/${path}`,
                        {
                            method: sha ? 'PUT' : 'PUT',
                            headers: this.getHeaders(true),
                            body: JSON.stringify(body)
                        }
                    );
                    
                    if (!response.ok) {
                        const error = await response.text();
                        console.error(`创建/更新文件 ${path} 失败:`, error);
                        return { success: false, error };
                    }
                    
                    const result = await response.json();
                    return { success: true, data: result };
                } catch (error) {
                    console.error(`创建/更新文件 ${path} 时发生错误:`, error);
                    return { success: false, error: error.message };
                }
            },
            
            // 删除文件 - 需要认证
            async deleteFile(path, message, sha) {
                try {
                    if (!sha) {
                        return { success: false, error: '缺少文件SHA值' };
                    }
                    
                    const response = await fetch(
                        `${Config.githubAPI}/repos/${State.githubOwner}/${State.githubRepo}/contents/${path}`,
                        {
                            method: 'DELETE',
                            headers: this.getHeaders(true),
                            body: JSON.stringify({
                                message: message || `Delete ${path}`,
                                sha: sha
                            })
                        }
                    );
                    
                    if (!response.ok) {
                        const error = await response.text();
                        console.error(`删除文件 ${path} 失败:`, error);
                        return { success: false, error };
                    }
                    
                    const result = await response.json();
                    return { success: true, data: result };
                } catch (error) {
                    console.error(`删除文件 ${path} 时发生错误:`, error);
                    return { success: false, error: error.message };
                }
            }
        };

        // 分类管理模块 - 确保分类ID为数字格式
        const CategoryManager = {
            // 加载分类
            async loadCategories() {
                try {
                    const result = await GitHubAPI.getFileContent(Config.categoriesFile);
                    
                    if (!result.success) {
                        // 如果文件不存在，初始化空分类
                        if (result.error.includes('404')) {
                            State.categories = [];
                            return true;
                        }
                        console.error('加载分类失败:', result.error);
                        return false;
                    }
                    
                    try {
                        // 解析分类数据
                        let categories = JSON.parse(result.content);
                        
                        // 验证并修复分类格式，确保ID为数字
                        if (Array.isArray(categories)) {
                            State.categories = categories.map(cat => {
                                // 确保ID是数字
                                const id = typeof cat.id === 'number' ? cat.id : parseInt(cat.id, 10) || Utils.getNextCategoryId();
                                return {
                                    id,
                                    name: cat.name || `未命名分类${id}`
                                };
                            });
                            
                            // 确保ID唯一且连续
                            this.ensureUniqueIds();
                            return true;
                        } else {
                            console.error('分类数据格式错误，应为数组');
                            State.categories = [];
                            return false;
                        }
                    } catch (parseError) {
                        console.error('解析分类数据失败:', parseError);
                        State.categories = [];
                        return false;
                    }
                } catch (error) {
                    console.error('加载分类时发生错误:', error);
                    return false;
                }
            },
            
            // 确保分类ID唯一且为数字
            ensureUniqueIds() {
                const ids = new Set();
                const uniqueCategories = [];
                
                State.categories.forEach(cat => {
                    let id = cat.id;
                    // 确保ID是数字
                    if (typeof id !== 'number') {
                        id = parseInt(id, 10) || Utils.getNextCategoryId();
                    }
                    
                    // 确保ID唯一
                    while (ids.has(id)) {
                        id++;
                    }
                    
                    ids.add(id);
                    uniqueCategories.push({ ...cat, id });
                });
                
                State.categories = uniqueCategories;
            },
            
            // 保存分类
            async saveCategories() {
                try {
                    // 先确保ID正确
                    this.ensureUniqueIds();
                    
                    const content = JSON.stringify(State.categories, null, 2);
                    // 检查是否已存在分类文件
                    const existingFile = await GitHubAPI.getFileContent(Config.categoriesFile);
                    
                    let result;
                    if (existingFile.success) {
                        // 更新现有文件
                        result = await GitHubAPI.createOrUpdateFile(
                            Config.categoriesFile,
                            content,
                            '更新分类列表',
                            existingFile.sha
                        );
                    } else {
                        // 创建新文件
                        result = await GitHubAPI.createOrUpdateFile(
                            Config.categoriesFile,
                            content,
                            '创建分类列表'
                        );
                    }
                    
                    if (result.success) {
                        Utils.showStatusMessage('分类保存成功');
                        return true;
                    } else {
                        console.error('保存分类失败:', result.error);
                        Utils.showStatusMessage('保存分类失败: ' + result.error, true);
                        return false;
                    }
                } catch (error) {
                    console.error('保存分类时发生错误:', error);
                    Utils.showStatusMessage('保存分类时发生错误: ' + error.message, true);
                    return false;
                }
            },
            
            // 添加新分类
            async addCategory(name) {
                if (!name || name.trim() === '') {
                    Utils.showStatusMessage('分类名称不能为空', true);
                    return false;
                }
                
                // 检查分类名称是否已存在
                if (State.categories.some(cat => cat.name.trim().toLowerCase() === name.trim().toLowerCase())) {
                    Utils.showStatusMessage('该分类名称已存在', true);
                    return false;
                }
                
                // 获取下一个可用的ID（数字格式）
                const newId = Utils.getNextCategoryId();
                
                // 添加新分类
                State.categories.push({
                    id: newId,
                    name: name.trim()
                });
                
                // 保存分类
                const success = await this.saveCategories();
                if (success) {
                    // 更新UI
                    this.renderCategoryTags();
                    this.renderCategorySelector();
                    this.renderCategoriesList();
                }
                
                return success;
            },
            
            // 更新分类
            async updateCategory(id, newName) {
                if (!newName || newName.trim() === '') {
                    Utils.showStatusMessage('分类名称不能为空', true);
                    return false;
                }
                
                const categoryIndex = State.categories.findIndex(cat => cat.id === id);
                if (categoryIndex === -1) {
                    Utils.showStatusMessage('分类不存在', true);
                    return false;
                }
                
                // 检查新名称是否已存在（排除当前分类）
                if (State.categories.some((cat, index) => 
                    index !== categoryIndex && 
                    cat.name.trim().toLowerCase() === newName.trim().toLowerCase()
                )) {
                    Utils.showStatusMessage('该分类名称已存在', true);
                    return false;
                }
                
                // 更新分类名称
                State.categories[categoryIndex].name = newName.trim();
                
                // 保存分类
                const success = await this.saveCategories();
                if (success) {
                    // 更新UI
                    this.renderCategoryTags();
                    this.renderCategorySelector();
                    this.renderCategoriesList();
                    ArticleManager.renderArticlesTable();
                }
                
                return success;
            },
            
            // 删除分类
            async deleteCategory(id) {
                // 检查是否有文章使用该分类
                const articlesWithCategory = State.articles.filter(article => 
                    article.categories && article.categories.includes(id)
                );
                
                if (articlesWithCategory.length > 0) {
                    if (!confirm(`该分类下有 ${articlesWithCategory.length} 篇文章，删除后这些文章将不再属于该分类。确定要删除吗？`)) {
                        return false;
                    }
                }
                
                // 从分类列表中移除
                State.categories = State.categories.filter(cat => cat.id !== id);
                
                // 保存分类
                const success = await this.saveCategories();
                if (success) {
                    // 更新UI
                    this.renderCategoryTags();
                    this.renderCategorySelector();
                    this.renderCategoriesList();
                    
                    // 如果当前选中的是被删除的分类，切换到"全部"
                    if (State.selectedCategory === id.toString()) {
                        State.selectedCategory = 'all';
                        document.querySelector('.分类标签.active').classList.remove('active');
                        document.querySelector('.分类标签[data-category="all"]').classList.add('active');
                    }
                }
                
                return success;
            },
            
            // 渲染分类标签
            renderCategoryTags() {
                const fragment = Utils.createFragment();
                
                // 添加"全部"标签（已存在于HTML中，这里不需要重复添加）
                
                // 添加各个分类标签
                State.categories.forEach(category => {
                    const tag = document.createElement('span');
                    tag.className = `分类标签 ${State.selectedCategory === category.id.toString() ? 'active' : ''}`;
                    tag.dataset.category = category.id;
                    tag.textContent = category.name;
                    
                    // 添加点击事件
                    tag.addEventListener('click', () => {
                        // 更新选中状态
                        document.querySelectorAll('.分类标签').forEach(t => t.classList.remove('active'));
                        tag.classList.add('active');
                        State.selectedCategory = category.id.toString();
                        ArticleManager.filterArticles();
                    });
                    
                    fragment.appendChild(tag);
                });
                
                // 清除现有分类标签（保留"全部"）
                const existingTags = Elements.分类容器.querySelectorAll('.分类标签:not([data-category="all"])');
                existingTags.forEach(tag => tag.remove());
                
                // 添加新标签
                Elements.分类容器.appendChild(fragment);
            },
            
            // 渲染分类选择器（用于撰写文章）
            renderCategorySelector() {
                const fragment = Utils.createFragment();
                
                State.categories.forEach(category => {
                    const container = document.createElement('div');
                    
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.id = `category-${category.id}`;
                    checkbox.value = category.id;
                    checkbox.className = 'category-checkbox';
                    
                    const label = document.createElement('label');
                    label.htmlFor = `category-${category.id}`;
                    label.textContent = category.name;
                    
                    container.appendChild(checkbox);
                    container.appendChild(label);
                    fragment.appendChild(container);
                });
                
                Elements.categorySelector.innerHTML = '';
                Elements.categorySelector.appendChild(fragment);
            },
            
            // 渲染分类列表（用于管理分类）
            renderCategoriesList() {
                const fragment = Utils.createFragment();
                
                if (State.categories.length === 0) {
                    const emptyMsg = document.createElement('p');
                    emptyMsg.className = 'text-gray-500 italic';
                    emptyMsg.textContent = '暂无分类，请添加新分类';
                    fragment.appendChild(emptyMsg);
                } else {
                    State.categories.forEach(category => {
                        const item = document.createElement('div');
                        item.className = 'flex items-center justify-between p-3 border rounded bg-white';
                        
                        const nameSpan = document.createElement('span');
                        nameSpan.textContent = category.name;
                        nameSpan.className = 'flex-1';
                        
                        const actions = document.createElement('div');
                        
                        const editBtn = document.createElement('button');
                        editBtn.className = 'text-blue-500 hover:text-blue-700 mr-3';
                        editBtn.innerHTML = '<i class="fa fa-pencil" aria-hidden="true"></i>';
                        editBtn.title = '编辑';
                        editBtn.addEventListener('click', () => this.handleEditCategory(category.id));
                        
                        const deleteBtn = document.createElement('button');
                        deleteBtn.className = 'text-red-500 hover:text-red-700';
                        deleteBtn.innerHTML = '<i class="fa fa-trash" aria-hidden="true"></i>';
                        deleteBtn.title = '删除';
                        deleteBtn.addEventListener('click', () => this.deleteCategory(category.id));
                        
                        actions.appendChild(editBtn);
                        actions.appendChild(deleteBtn);
                        
                        item.appendChild(nameSpan);
                        item.appendChild(actions);
                        
                        fragment.appendChild(item);
                    });
                }
                
                Elements.categoriesList.innerHTML = '';
                Elements.categoriesList.appendChild(fragment);
            },
            
            // 处理编辑分类
            handleEditCategory(id) {
                const category = State.categories.find(cat => cat.id === id);
                if (!category) return;
                
                const newName = prompt('请输入新的分类名称:', category.name);
                if (newName !== null && newName.trim() !== '' && newName !== category.name) {
                    this.updateCategory(id, newName);
                }
            }
        };

        // 文章管理模块
        const ArticleManager = {
            // 加载文章列表
            async loadArticles() {
                try {
                    Elements.文章加载指示器.classList.remove('hidden');
                    Elements.文章列表.classList.add('hidden');
                    
                    // 获取文章目录下的所有文件
                    const result = await GitHubAPI.getFilesList(Config.articlesDir);
                    
                    if (!result.success) {
                        console.error('获取文章列表失败:', result.error);
                        Utils.showStatusMessage('加载文章失败: ' + result.error, true);
                        Elements.文章加载指示器.classList.add('hidden');
                        return false;
                    }
                    
                    // 过滤出Markdown文件
                    const mdFiles = result.files.filter(file => 
                        file.type === 'file' && file.name.endsWith('.md')
                    );
                    
                    // 加载每篇文章的内容
                    const articles = [];
                    for (const file of mdFiles) {
                        const contentResult = await GitHubAPI.getFileContent(file.path);
                        
                        if (contentResult.success) {
                            // 解析文章元数据
                            const article = this.parseArticleContent(contentResult.content, file);
                            articles.push(article);
                        } else {
                            console.error(`加载文章 ${file.name} 失败:`, contentResult.error);
                        }
                    }
                    
                    // 按日期排序（最新的在前）
                    articles.sort((a, b) => new Date(b.date) - new Date(a.date));
                    
                    State.articles = articles;
                    
                    // 渲染文章列表
                    this.renderArticles();
                    // 渲染文章管理表格
                    this.renderArticlesTable();
                    
                    Elements.文章加载指示器.classList.add('hidden');
                    Elements.文章列表.classList.remove('hidden');
                    
                    return true;
                } catch (error) {
                    console.error('加载文章时发生错误:', error);
                    Utils.showStatusMessage('加载文章时发生错误: ' + error.message, true);
                    Elements.文章加载指示器.classList.add('hidden');
                    return false;
                }
            },
            
            // 解析文章内容，提取分类和标题
            parseArticleContent(content, file) {
                // 从文件名提取日期（假设格式为 YYYY-MM-DD-标题.md）
                const dateMatch = file.name.match(/^(\d{4}-\d{2}-\d{2})-/);
                const date = dateMatch ? dateMatch[1] : new Date(file.updated_at).toISOString().split('T')[0];
                
                // 提取第一行的分类ID
                const lines = content.split('\n');
                let categories = [];
                let contentWithoutCategories = content;
                
                if (lines.length > 0 && lines[0].trim() !== '') {
                    try {
                        // 第一行应为分类ID，用逗号分隔
                        const categoryIds = lines[0].split(',').map(id => parseInt(id.trim(), 10)).filter(Boolean);
                        categories = categoryIds;
                        // 移除第一行
                        contentWithoutCategories = lines.slice(1).join('\n');
                    } catch (e) {
                        console.warn('解析分类ID失败，使用空分类', e);
                    }
                }
                
                // 从内容中提取标题（寻找第一个#标题）
                let title = file.name.replace(/^\d{4}-\d{2}-\d{2}-/, '').replace(/\.md$/, '').replace(/-/g, ' ');
                const titleMatch = contentWithoutCategories.match(/#{1,2}\s+(.*?)\n/);
                if (titleMatch && titleMatch[1]) {
                    title = titleMatch[1];
                }
                
                // 生成预览HTML
                const previewHtml = marked.parse(contentWithoutCategories);
                
                return {
                    id: file.sha,
                    title,
                    date,
                    fileName: file.name,
                    filePath: file.path,
                    sha: file.sha,
                    categories,
                    content: contentWithoutCategories,
                    previewHtml,
                    summary: Utils.getArticleSummary(previewHtml),
                    updatedAt: file.updated_at
                };
            },
            
            // 渲染文章列表
            renderArticles() {
                const fragment = Utils.createFragment();
                const filteredArticles = this.getFilteredArticles();
                
                if (filteredArticles.length === 0) {
                    const emptyMsg = document.createElement('div');
                    emptyMsg.className = 'col-span-full text-center py-12 text-gray-500';
                    emptyMsg.innerHTML = '<i class="fa fa-file-text-o text-4xl mb-3" aria-hidden="true"></i><p>暂无符合条件的文章</p>';
                    fragment.appendChild(emptyMsg);
                } else {
                    filteredArticles.forEach(article => {
                        const card = document.createElement('div');
                        card.className = '文章-card bg-white shadow';
                        
                        // 文章日期
                        const dateEl = document.createElement('div');
                        dateEl.className = 'bg-primary text-white p-2 text-sm';
                        dateEl.textContent = article.date;
                        
                        // 文章内容
                        const contentEl = document.createElement('div');
                        contentEl.className = 'p-5';
                        
                        // 文章标题
                        const titleEl = document.createElement('h3');
                        titleEl.className = 'text-xl font-bold mb-2 hover:text-primary transition-all-300';
                        titleEl.textContent = article.title;
                        
                        // 文章分类
                        const categoriesEl = document.createElement('div');
                        categoriesEl.className = 'mb-3 flex flex-wrap gap-1';
                        
                        if (article.categories && article.categories.length > 0) {
                            article.categories.forEach(catId => {
                                const catName = Utils.getCategoryNameById(catId);
                                if (catName) {
                                    const catEl = document.createElement('span');
                                    catEl.className = 'px-2 py-1 bg-secondary/30 text-dark text-xs rounded';
                                    catEl.textContent = catName;
                                    categoriesEl.appendChild(catEl);
                                }
                            });
                        }
                        
                        // 文章摘要
                        const summaryEl = document.createElement('p');
                        summaryEl.className = 'text-gray-600 mb-4';
                        summaryEl.textContent = article.summary;
                        
                        // 阅读更多按钮
                        const readMoreBtn = document.createElement('button');
                        readMoreBtn.className = 'text-primary hover:text-accent font-medium flex items-center';
                        readMoreBtn.innerHTML = '阅读更多 <i class="fa fa-arrow-right ml-1" aria-hidden="true"></i>';
                        readMoreBtn.addEventListener('click', () => this.showArticleDetail(article));
                        
                        contentEl.appendChild(titleEl);
                        contentEl.appendChild(categoriesEl);
                        contentEl.appendChild(summaryEl);
                        contentEl.appendChild(readMoreBtn);
                        
                        card.appendChild(dateEl);
                        card.appendChild(contentEl);
                        
                        fragment.appendChild(card);
                    });
                }
                
                Elements.文章列表.innerHTML = '';
                Elements.文章列表.appendChild(fragment);
            },
            
            // 按分类过滤文章
            filterArticles() {
                this.renderArticles();
            },
            
            // 获取过滤后的文章
            getFilteredArticles() {
                if (State.selectedCategory === 'all') {
                    return State.articles;
                }
                
                const categoryId = parseInt(State.selectedCategory, 10);
                return State.articles.filter(article => 
                    article.categories && article.categories.includes(categoryId)
                );
            },
            
            // 显示文章详情
            showArticleDetail(article) {
                if (!article) return;
                
                const detailContent = document.createElement('div');
                detailContent.className = 'p-4';
                
                // 文章标题
                const titleEl = document.createElement('h2');
                titleEl.className = 'text-3xl font-bold mb-6 text-center';
                titleEl.textContent = article.title;
                
                // 文章元数据（日期和分类）
                const metaEl = document.createElement('div');
                metaEl.className = 'flex flex-wrap justify-center gap-x-6 gap-y-2 text-gray-600 mb-8 pb-4 border-b';
                
                const dateEl = document.createElement('div');
                dateEl.className = 'flex items-center';
                dateEl.innerHTML = '<i class="fa fa-calendar mr-2" aria-hidden="true"></i> ' + article.date;
                
                const categoriesEl = document.createElement('div');
                categoriesEl.className = 'flex items-center flex-wrap gap-2';
                categoriesEl.innerHTML = '<i class="fa fa-tags mr-2" aria-hidden="true"></i>';
                
                if (article.categories && article.categories.length > 0) {
                    article.categories.forEach(catId => {
                        const catName = Utils.getCategoryNameById(catId);
                        if (catName) {
                            const catEl = document.createElement('span');
                            catEl.className = 'px-2 py-1 bg-secondary/30 text-dark text-sm rounded';
                            catEl.textContent = catName;
                            categoriesEl.appendChild(catEl);
                        }
                    });
                } else {
                    categoriesEl.innerHTML += ' 无分类';
                }
                
                metaEl.appendChild(dateEl);
                metaEl.appendChild(categoriesEl);
                
                // 文章内容
                const contentEl = document.createElement('div');
                contentEl.className = 'prose prose-lg max-w-none mx-auto';
                contentEl.innerHTML = article.previewHtml;
                
                detailContent.appendChild(titleEl);
                detailContent.appendChild(metaEl);
                detailContent.appendChild(contentEl);
                
                Elements.文章详情内容.innerHTML = '';
                Elements.文章详情内容.appendChild(detailContent);
                
                // 显示模态框
                Elements.文章详情模态框.style.display = 'block';
            },
            
            // 发布文章
            async publishArticle() {
                const title = Elements.articleTitleInput.value.trim();
                if (!title) {
                    Utils.showStatusMessage('文章标题不能为空', true);
                    return false;
                }
                
                // 获取选中的分类
                const selectedCategories = [];
                document.querySelectorAll('.category-checkbox:checked').forEach(checkbox => {
                    selectedCategories.push(parseInt(checkbox.value, 10));
                });
                
                let content = Elements.articleEditor.value.trim();
                
                // 在内容开头添加分类ID
                if (selectedCategories.length > 0) {
                    content = selectedCategories.join(',') + '\n' + content;
                } else {
                    // 如果没有选择分类，确保第一行为空行
                    content = '\n' + content;
                }
                
                // 生成文件名
                const fileName = Utils.generateArticleFileName(title);
                const filePath = `${Config.articlesDir}/${fileName}`;
                
                try {
                    // 检查文件是否已存在
                    const existingFile = await GitHubAPI.getFileContent(filePath);
                    
                    let result;
                    if (existingFile.success) {
                        // 文件已存在，询问是否覆盖
                        if (!confirm('同名文章已存在，是否覆盖？')) {
                            return false;
                        }
                        // 更新文件
                        result = await GitHubAPI.createOrUpdateFile(
                            filePath,
                            content,
                            `更新文章: ${title}`,
                            existingFile.sha
                        );
                    } else {
                        // 创建新文件
                        result = await GitHubAPI.createOrUpdateFile(
                            filePath,
                            content,
                            `发布新文章: ${title}`
                        );
                    }
                    
                    if (result.success) {
                        Utils.showStatusMessage('文章发布成功');
                        // 清空表单
                        Elements.articleTitleInput.value = '';
                        Elements.articleEditor.value = '';
                        document.querySelectorAll('.category-checkbox:checked').forEach(checkbox => {
                            checkbox.checked = false;
                        });
                        Elements.previewContainer.innerHTML = '<p class="text-gray-500 italic">预览将显示在这里...</p>';
                        
                        // 重新加载文章列表
                        this.loadArticles();
                        return true;
                    } else {
                        console.error('发布文章失败:', result.error);
                        Utils.showStatusMessage('发布文章失败: ' + result.error, true);
                        return false;
                    }
                } catch (error) {
                    console.error('发布文章时发生错误:', error);
                    Utils.showStatusMessage('发布文章时发生错误: ' + error.message, true);
                    return false;
                }
            },
            
            // 渲染文章管理表格
            renderArticlesTable() {
                const tbody = Elements.articlesTable.querySelector('tbody');
                tbody.innerHTML = '';
                
                if (State.articles.length === 0) {
                    const row = document.createElement('tr');
                    row.innerHTML = '<td colspan="4" class="py-4 px-4 text-center text-gray-500">暂无文章</td>';
                    tbody.appendChild(row);
                    return;
                }
                
                State.articles.forEach(article => {
                    const row = document.createElement('tr');
                    row.className = 'border-b hover:bg-gray-50';
                    
                    // 标题
                    const titleCell = document.createElement('td');
                    titleCell.className = 'py-3 px-4';
                    titleCell.textContent = article.title;
                    
                    // 日期
                    const dateCell = document.createElement('td');
                    dateCell.className = 'py-3 px-4';
                    dateCell.textContent = article.date;
                    
                    // 分类
                    const categoriesCell = document.createElement('td');
                    categoriesCell.className = 'py-3 px-4';
                    
                    const categoryNames = Utils.getCategoryNamesByIds(article.categories);
                    if (categoryNames.length > 0) {
                        categoriesCell.textContent = categoryNames.join(', ');
                    } else {
                        categoriesCell.innerHTML = '<span class="text-gray-400 italic">无</span>';
                    }
                    
                    // 操作
                    const actionsCell = document.createElement('td');
                    actionsCell.className = 'py-3 px-4 text-center';
                    
                    const viewBtn = document.createElement('button');
                    viewBtn.className = 'text-blue-500 hover:text-blue-700 mr-3';
                    viewBtn.innerHTML = '<i class="fa fa-eye" aria-hidden="true"></i>';
                    viewBtn.title = '查看';
                    viewBtn.addEventListener('click', () => this.showArticleDetail(article));
                    
                    const editBtn = document.createElement('button');
                    editBtn.className = 'text-green-500 hover:text-green-700 mr-3';
                    editBtn.innerHTML = '<i class="fa fa-pencil" aria-hidden="true"></i>';
                    editBtn.title = '编辑';
                    editBtn.addEventListener('click', () => this.editArticle(article));
                    
                    const deleteBtn = document.createElement('button');
                    deleteBtn.className = 'text-red-500 hover:text-red-700';
                    deleteBtn.innerHTML = '<i class="fa fa-trash" aria-hidden="true"></i>';
                    deleteBtn.title = '删除';
                    deleteBtn.addEventListener('click', () => this.deleteArticle(article));
                    
                    actionsCell.appendChild(viewBtn);
                    actionsCell.appendChild(editBtn);
                    actionsCell.appendChild(deleteBtn);
                    
                    row.appendChild(titleCell);
                    row.appendChild(dateCell);
                    row.appendChild(categoriesCell);
                    row.appendChild(actionsCell);
                    
                    tbody.appendChild(row);
                });
            },
            
            // 编辑文章
            editArticle(article) {
                // 切换到撰写文章标签
                Elements.adminMenuItems.forEach(item => item.classList.remove('active'));
                Elements.adminSections.forEach(section => section.classList.remove('active'));
                document.querySelector('.admin-menu-item[data-section="write-article"]').classList.add('active');
                document.getElementById('write-article').classList.add('active');
                
                // 填充表单
                Elements.articleTitleInput.value = article.title;
                
                // 移除内容中的分类ID行，只保留正文
                const contentWithoutCategories = article.content || '';
                Elements.articleEditor.value = contentWithoutCategories;
                
                // 更新预览
                this.updatePreview();
                
                // 选中分类
                document.querySelectorAll('.category-checkbox').forEach(checkbox => {
                    checkbox.checked = article.categories && article.categories.includes(parseInt(checkbox.value, 10));
                });
            },
            
            // 删除文章
            async deleteArticle(article) {
                if (!confirm(`确定要删除文章《${article.title}》吗？此操作不可恢复。`)) {
                    return false;
                }
                
                try {
                    const result = await GitHubAPI.deleteFile(
                        article.filePath,
                        `删除文章: ${article.title}`,
                        article.sha
                    );
                    
                    if (result.success) {
                        Utils.showStatusMessage('文章删除成功');
                        // 重新加载文章列表
                        this.loadArticles();
                        return true;
                    } else {
                        console.error('删除文章失败:', result.error);
                        Utils.showStatusMessage('删除文章失败: ' + result.error, true);
                        return false;
                    }
                } catch (error) {
                    console.error('删除文章时发生错误:', error);
                    Utils.showStatusMessage('删除文章时发生错误: ' + error.message, true);
                    return false;
                }
            },
            
            // 更新预览
            updatePreview() {
                const content = Elements.articleEditor.value;
                const html = marked.parse(content);
                Elements.previewContainer.innerHTML = html;
            }
        };

        // 日历模块
        const Calendar = {
            // 初始化日历
            init() {
                this.renderCalendar();
                this.updateCurrentTime();
                setInterval(() => this.updateCurrentTime(), 60000); // 每分钟更新一次时间
                this.showRandomPhilosophicalQuote();
            },
            
            // 渲染日历
            renderCalendar() {
                const year = State.currentDate.getFullYear();
                const month = State.currentDate.getMonth();
                
                // 更新当前年月显示
                Elements.当前年月显示.textContent = `${year}年${month + 1}月`;
                
                // 获取当月第一天是星期几
                const firstDay = new Date(year, month, 1).getDay();
                
                // 获取当月的天数
                const daysInMonth = new Date(year, month + 1, 0).getDate();
                
                // 清空日历网格
                Elements.日历网格.innerHTML = '';
                
                // 添加星期标题
                const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
                weekdays.forEach(day => {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'font-bold py-2';
                    dayEl.textContent = day;
                    Elements.日历网格.appendChild(dayEl);
                });
                
                // 添加空白单元格
                for (let i = 0; i < firstDay; i++) {
                    const emptyEl = document.createElement('div');
                    emptyEl.className = 'py-2';
                    Elements.日历网格.appendChild(emptyEl);
                }
                
                // 添加日期单元格
                const today = new Date();
                const isCurrentMonth = today.getFullYear() === year && today.getMonth() === month;
                
                for (let day = 1; day <= daysInMonth; day++) {
                    const dayEl = document.createElement('div');
                    dayEl.className = 'py-2 rounded border hover:bg-secondary/20 transition-all-300 cursor-pointer';
                    
                    // 如果是今天，添加特殊样式
                    if (isCurrentMonth && today.getDate() === day) {
                        dayEl.classList.add('今日日期标记', 'font-bold');
                    }
                    
                    dayEl.textContent = day;
                    
                    // 添加点击事件
                    dayEl.addEventListener('click', () => {
                        const selectedDate = new Date(year, month, day);
                        this.onDateSelected(selectedDate);
                    });
                    
                    Elements.日历网格.appendChild(dayEl);
                }
            },
            
            // 上一个月
            prevMonth() {
                State.currentDate.setMonth(State.currentDate.getMonth() - 1);
                this.renderCalendar();
            },
            
            // 下一个月
            nextMonth() {
                State.currentDate.setMonth(State.currentDate.getMonth() + 1);
                this.renderCalendar();
            },
            
            // 更新当前时间显示
            updateCurrentTime() {
                const now = new Date();
                Elements.当前时间显示.textContent = now.toLocaleString('zh-CN', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    weekday: 'long',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            },
            
            // 显示随机哲言
            showRandomPhilosophicalQuote() {
                const randomIndex = Math.floor(Math.random() * State.philosophicalQuotes.length);
                const quote = State.philosophicalQuotes[randomIndex];
                
                Elements.哲言区域.innerHTML = `
                    <p>"${quote.quote}"</p>
                    <p class="mt-2 text-right">— ${quote.author}</p>
                `;
            },
            
            // 日期选中事件
            onDateSelected(date) {
                const formattedDate = Utils.formatDate(date);
                // 查找该日期的文章
                const articlesOnDate = State.articles.filter(article => article.date === formattedDate);
                
                if (articlesOnDate.length > 0) {
                    // 显示该日期的文章
                    alert(`在 ${formattedDate} 有 ${articlesOnDate.length} 篇文章`);
                    // 可以在这里实现更复杂的文章列表展示
                } else {
                    alert(`在 ${formattedDate} 没有文章`);
                }
            }
        };

        // 管理后台模块
        const AdminPanel = {
            // 初始化管理后台
            async init() {
                if (!State.isAuthenticated) {
                    this.showAuthModal();
                    return;
                }
                
                this.showAdminPanel();
            },
            
            // 显示管理后台
            async showAdminPanel() {
                Elements.后台管理模态框.style.display = 'block';
                Elements.adminLoading.classList.remove('hidden');
                Elements.adminContentContainer.classList.add('hidden');
                
                try {
                    // 加载分类
                    await CategoryManager.loadCategories();
                    
                    // 渲染分类选择器
                    CategoryManager.renderCategorySelector();
                    
                    // 渲染分类列表
                    CategoryManager.renderCategoriesList();
                    
                    // 显示当前仓库信息
                    Elements.currentRepoInfo.textContent = `${State.githubOwner}/${State.githubRepo}`;
                    
                    Elements.adminLoading.classList.add('hidden');
                    Elements.adminContentContainer.classList.remove('hidden');
                } catch (error) {
                    console.error('初始化管理后台失败:', error);
                    Utils.showStatusMessage('初始化管理后台失败: ' + error.message, true);
                    Elements.adminLoading.classList.add('hidden');
                }
            },
            
            // 显示认证模态框
            showAuthModal() {
                Elements.github验证模态框.style.display = 'block';
                Elements.githubTokenInput.value = '';
                Utils.hideErrorLog(Elements.验证错误日志);
            },
            
            // 验证GitHub令牌
            async verifyToken() {
                const token = Elements.githubTokenInput.value.trim();
                if (!token) {
                    Utils.showErrorLog(Elements.验证错误日志, '请输入GitHub令牌');
                    return;
                }
                
                // 显示验证状态
                Elements.验证状态.textContent = '正在验证...';
                Elements.验证状态.className = 'mt-3 text-center';
                Elements.验证状态.classList.remove('hidden', 'text-green-500', 'text-red-500');
                
                try {
                    // 临时保存令牌用于验证
                    State.githubToken = token;
                    
                    // 测试令牌有效性
                    const isValid = await GitHubAPI.testToken();
                    
                    if (isValid) {
                        // 验证成功，保存令牌
                        localStorage.setItem('githubToken', token);
                        State.isAuthenticated = true;
                        
                        Elements.验证状态.textContent = '验证成功！正在进入管理后台...';
                        Elements.验证状态.classList.add('text-green-500');
                        
                        // 关闭验证模态框并显示管理后台
                        setTimeout(() => {
                            Elements.github验证模态框.style.display = 'none';
                            this.showAdminPanel();
                        }, 1000);
                    } else {
                        // 验证失败
                        Elements.验证状态.textContent = '验证失败，请检查令牌是否正确';
                        Elements.验证状态.classList.add('text-red-500');
                        State.githubToken = null;
                    }
                } catch (error) {
                    console.error('验证令牌时发生错误:', error);
                    Elements.验证状态.textContent = '验证时发生错误: ' + error.message;
                    Elements.验证状态.classList.add('text-red-500');
                    State.githubToken = null;
                }
            },
            
            // 切换管理菜单
            switchMenu(sectionId) {
                // 更新菜单选中状态
                Elements.adminMenuItems.forEach(item => {
                    item.classList.toggle('active', item.dataset.section === sectionId);
                });
                
                // 更新显示的区域
                Elements.adminSections.forEach(section => {
                    section.classList.toggle('active', section.id === sectionId);
                });
                
                // 如果切换到文章管理，刷新文章列表
                if (sectionId === 'manage-articles') {
                    ArticleManager.renderArticlesTable();
                }
                
                // 如果切换到分类管理，刷新分类列表
                if (sectionId === 'manage-categories') {
                    CategoryManager.renderCategoriesList();
                }
            },
            
            // 退出登录
            logout() {
                if (confirm('确定要退出登录吗？')) {
                    localStorage.removeItem('githubToken');
                    State.githubToken = null;
                    State.isAuthenticated = false;
                    Elements.后台管理模态框.style.display = 'none';
                    this.showAuthModal();
                }
            },
            
            // 切换仓库
            async switchRepo() {
                Elements.后台管理模态框.style.display = 'none';
                await this.showRepoSelectModal();
            },
            
            // 显示仓库选择模态框
            async showRepoSelectModal() {
                if (!State.isAuthenticated) {
                    this.showAuthModal();
                    return;
                }
                
                Elements.repoSelectModal.style.display = 'block';
                Elements.repoLoading.classList.remove('hidden');
                Elements.repoListContainer.classList.add('hidden');
                Utils.hideErrorLog(Elements.repoSelectError);
                Elements.confirmRepoBtn.disabled = true;
                
                try {
                    // 获取用户仓库列表
                    const result = await GitHubAPI.getUserRepos();
                    
                    if (!result.success) {
                        Utils.showErrorLog(Elements.repoSelectError, result.error);
                        Elements.repoLoading.classList.add('hidden');
                        Elements.repoListContainer.classList.remove('hidden');
                        return;
                    }
                    
                    // 过滤出适合的仓库（名称包含philosophy或blog）
                    const filteredRepos = result.repos.filter(repo => 
                        repo.name.toLowerCase().includes('philosophy') || 
                        repo.name.toLowerCase().includes('blog') ||
                        repo.name.toLowerCase().includes('wiki')
                    );
                    
                    // 渲染仓库列表
                    const fragment = Utils.createFragment();
                    
                    if (filteredRepos.length === 0) {
                        const emptyMsg = document.createElement('p');
                        emptyMsg.className = 'text-gray-500 italic p-4';
                        emptyMsg.textContent = '未找到适合的仓库，请先创建一个包含"philosophy"或"blog"的仓库';
                        fragment.appendChild(emptyMsg);
                    } else {
                        filteredRepos.forEach(repo => {
                            const repoItem = document.createElement('div');
                            repoItem.className = `repo-item ${State.githubRepo === repo.name ? 'selected' : ''}`;
                            repoItem.dataset.owner = repo.owner.login;
                            repoItem.dataset.name = repo.name;
                            
                            repoItem.innerHTML = `
                                <div class="font-medium">${repo.name}</div>
                                <div class="text-sm text-gray-600 mt-1">${repo.description || '无描述'}</div>
                            `;
                            
                            repoItem.addEventListener('click', () => {
                                // 移除其他选中状态
                                document.querySelectorAll('.repo-item').forEach(item => {
                                    item.classList.remove('selected');
                                });
                                // 添加当前选中状态
                                repoItem.classList.add('selected');
                                // 启用确认按钮
                                Elements.confirmRepoBtn.disabled = false;
                                // 保存选中的仓库
                                State.selectedRepo = {
                                    owner: repo.owner.login,
                                    name: repo.name
                                };
                            });
                            
                            fragment.appendChild(repoItem);
                        });
                    }
                    
                    Elements.repoList.innerHTML = '';
                    Elements.repoList.appendChild(fragment);
                    
                    Elements.repoLoading.classList.add('hidden');
                    Elements.repoListContainer.classList.remove('hidden');
                } catch (error) {
                    console.error('获取仓库列表时发生错误:', error);
                    Utils.showErrorLog(Elements.repoSelectError, error.message);
                    Elements.repoLoading.classList.add('hidden');
                    Elements.repoListContainer.classList.remove('hidden');
                }
            },
            
            // 确认选择仓库
            confirmRepoSelection() {
                if (!State.selectedRepo) return;
                
                // 保存仓库信息
                Utils.saveRepoInfo(State.selectedRepo.owner, State.selectedRepo.name);
                
                // 关闭仓库选择模态框
                Elements.repoSelectModal.style.display = 'none';
                
                // 重新加载数据并显示管理后台
                this.showAdminPanel();
                
                // 重新加载文章
                ArticleManager.loadArticles();
                
                Utils.showStatusMessage(`已切换到仓库: ${State.githubOwner}/${State.githubRepo}`);
            }
        };

        // 初始化事件监听
        function initEventListeners() {
            // 关闭模态框按钮
            Elements.closeButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // 点击模态框外部关闭
            Elements.modals.forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.style.display = 'none';
                    }
                });
            });
            
            // 日历按钮
            Elements.日历按钮.addEventListener('click', () => {
                Elements.日历模态框.style.display = 'block';
            });
            
            // 日历上一个月
            Elements.上一月按钮.addEventListener('click', () => {
                Calendar.prevMonth();
            });
            
            // 日历下一个月
            Elements.下一月按钮.addEventListener('click', () => {
                Calendar.nextMonth();
            });
            
            // 尘幕工作室按钮（管理后台）
            Elements.尘幕工作室按钮.addEventListener('click', () => {
                AdminPanel.init();
            });
            
            // 全部分类按钮
            document.querySelector('.分类标签[data-category="all"]').addEventListener('click', () => {
                document.querySelectorAll('.分类标签').forEach(tag => tag.classList.remove('active'));
                document.querySelector('.分类标签[data-category="all"]').classList.add('active');
                State.selectedCategory = 'all';
                ArticleManager.filterArticles();
            });
            
            // 编辑器按钮
            Elements.editorButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const command = this.dataset.command;
                    const editor = Elements.articleEditor;
                    const start = editor.selectionStart;
                    const end = editor.selectionEnd;
                    const selectedText = editor.value.substring(start, end);
                    
                    let resultText = '';
                    
                    switch (command) {
                        case 'bold':
                            resultText = `**${selectedText || '粗体文本'}**`;
                            break;
                        case 'italic':
                            resultText = `*${selectedText || '斜体文本'}*`;
                            break;
                        case 'heading':
                            resultText = `# ${selectedText || '标题'}`;
                            break;
                        case 'list':
                            resultText = `- ${selectedText || '列表项1'}\n- 列表项2\n- 列表项3`;
                            break;
                        case 'link':
                            resultText = `[${selectedText || '链接文本'}](https://example.com)`;
                            break;
                        case 'image':
                            resultText = `![${selectedText || '图片描述'}](https://picsum.photos/800/400)`;
                            break;
                        case 'code':
                            resultText = `\`\`\`\n${selectedText || '代码块'}\n\`\`\``;
                            break;
                    }
                    
                    // 替换选中的文本
                    editor.value = editor.value.substring(0, start) + resultText + editor.value.substring(end);
                    
                    // 移动光标到插入内容的末尾
                    const newCursorPos = start + resultText.length;
                    editor.focus();
                    editor.setSelectionRange(newCursorPos, newCursorPos);
                    
                    // 更新预览
                    ArticleManager.updatePreview();
                });
            });
            
            // 文章编辑器输入事件（更新预览）
            Elements.articleEditor.addEventListener('input', () => {
                ArticleManager.updatePreview();
            });
            
            // 发布文章按钮
            Elements.发布文章按钮.addEventListener('click', () => {
                ArticleManager.publishArticle();
            });
            
            // 管理菜单切换
            Elements.adminMenuItems.forEach(item => {
                if (item.dataset.section) {
                    item.addEventListener('click', () => {
                        AdminPanel.switchMenu(item.dataset.section);
                    });
                }
            });
            
            // 添加分类按钮
            Elements.addCategoryBtn.addEventListener('click', () => {
                const categoryName = Elements.newCategoryName.value.trim();
                CategoryManager.addCategory(categoryName);
                Elements.newCategoryName.value = '';
            });
            
            // 验证按钮
            Elements.验证按钮.addEventListener('click', () => {
                AdminPanel.verifyToken();
            });
            
            // 退出登录按钮
            Elements.退出登录按钮.addEventListener('click', () => {
                AdminPanel.logout();
            });
            
            // 切换仓库按钮
            Elements.切换仓库按钮.addEventListener('click', () => {
                AdminPanel.switchRepo();
            });
            
            // 确认仓库选择按钮
            Elements.confirmRepoBtn.addEventListener('click', () => {
                AdminPanel.confirmRepoSelection();
            });
            
            // 前往认证按钮
            Elements.goToAuthBtn.addEventListener('click', () => {
                Elements.repoDetectFailModal.style.display = 'none';
                AdminPanel.showAuthModal();
            });
        }

        // 初始化应用
        async function initApp() {
            // 初始化事件监听
            initEventListeners();
            
            // 初始化日历
            Calendar.init();
            
            // 加载分类
            await CategoryManager.loadCategories();
            CategoryManager.renderCategoryTags();
            
            // 加载文章
            await ArticleManager.loadArticles();
            
            // 设置自动同步
            setInterval(async () => {
                console.log('自动同步数据...');
                await CategoryManager.loadCategories();
                CategoryManager.renderCategoryTags();
                await ArticleManager.loadArticles();
            }, Config.syncInterval);
        }

        // 启动应用
        document.addEventListener('DOMContentLoaded', initApp);
    </script>
</body>
</html>
